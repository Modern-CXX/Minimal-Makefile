# main -> libfoo.so -> libbar.so

$ find . | sed -e 's;[^/]*/;|____;g;s;____|; |;g'
.
|____.vscode
| |____launch.json
| |____settings.json
| |____tasks.json
|____src
| |____foo
| | |____Makefile
| | |____foo.c
| | |____foo.h
| |____main
| | |____main.c
| | |____Makefile
| |____Makefile
| |____bar
| | |____bar.c
| | |____Makefile
| | |____bar.h
$

$ cat src/bar/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g -fPIC # -O3 # CXXFLAGS for .cpp
CPPFLAGS = -MMD -MP # -I../xxx
LDFLAGS  = -shared # -L../xxx -Wl,-rpath,'$$ORIGIN/../xxx'
LDLIBS   = # -lxxx
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
bar : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d bar
.PHONY : clean
$

$ cat src/foo/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g -fPIC # -O3 # CXXFLAGS for .cpp
CPPFLAGS = -MMD -MP -I../bar
LDFLAGS  = -shared -L../bar -Wl,-rpath,'$$ORIGIN/../bar'
LDLIBS   = -lbar
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
foo : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d foo
.PHONY : clean
$

$ cat src/main/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g # -O3 -fPIC # CXXFLAGS for .cpp
CPPFLAGS = -MMD -MP -I../foo
LDFLAGS  = -L../foo -Wl,-rpath,'$$ORIGIN/../foo' # -shared
LDLIBS   = -lfoo
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
main : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d main
.PHONY : clean
$

$ cat src/Makefile
LIBDIRS = bar foo
MAIN = main
all : $(LIBDIRS) $(MAIN)
$(LIBDIRS) :
	$(MAKE) -C $@
	cp $@/$@ $@/lib$@.so
$(MAIN) :
	$(MAKE) -C $@
clean :
	for dir in $(LIBDIRS) $(MAIN); do \
		$(MAKE) -C $$dir $@; \
	done
.PHONY : $(LIBDIRS) $(MAIN) all clean
$(MAIN) : $(LIBDIRS)
foo : bar
$

$ cat .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "lldb",
      "request": "launch",
      "name": "Debug",
      "program": "${workspaceFolder}/src/main/${fileBasenameNoExtension}",
      "args": [],
      "cwd": "${workspaceFolder}/src/main",
      "preLaunchTask": "make",
    }
  ]
}
$

$ cat .vscode/tasks.json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "make",
      "type": "shell",
      "options": {
        "cwd": "${workspaceFolder}/src"
      },
      "command": "/usr/bin/make",
    }
  ]
}
$

$ cat .vscode/settings.json
{
  "clangd.fallbackFlags": [
    // "-std=c++2a",
    "-I${workspaceFolder}/src/foo",
    "-I${workspaceFolder}/src/bar",
    // "-I${workspaceFolder}/boost",
  ],
}
$
