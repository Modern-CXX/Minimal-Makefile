# main -> libfoo.so -> libbar.so

$ ls
Makefile  bar  foo  main
$
$ find . | sed -e 's;[^/]*/;|____;g;s;____|; |;g'
.
|____Makefile
|____foo
| |____Makefile
| |____foo.c
| |____foo.h
|____bar
| |____Makefile
| |____bar.h
| |____bar.c
|____main
| |____Makefile
| |____main.c
$

$ cat Makefile
SUBDIRS = bar foo main
subdirs : $(SUBDIRS)
$(SUBDIRS) :
	make -C $@
	cp $@/$@ $@/lib$@.so
clean :
	for dir in $(SUBDIRS); do \
		make -C $$dir $@; \
	done
.PHONY : $(SUBDIRS) subdirs clean

main :
	make -C $@

main : foo
foo : bar
$

$ cat bar/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g -fPIC # -O3 # CXXFLAGS for .cpp
LDFLAGS  = -shared # -L../xxx -Wl,-rpath,'$$ORIGIN/../xxx'
LDLIBS   = # -lxxx
CPPFLAGS = -MMD -MP # -I../xxx
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
bar : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d bar
.PHONY : clean
$

$ cat foo/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g -fPIC # -O3 # CXXFLAGS for .cpp
LDFLAGS  = -L../bar -Wl,-rpath,'$$ORIGIN/../bar' -shared
LDLIBS   = -lbar
CPPFLAGS = -MMD -MP -I../bar
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
foo : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d foo
.PHONY : clean
$

$ cat main/Makefile
# build shared library with -fPIC, -shared
CFLAGS   = -g # -O3 -fPIC # CXXFLAGS for .cpp
LDFLAGS  = -L../foo -Wl,-rpath,'$$ORIGIN/../foo' # -shared
LDLIBS   = -lfoo
CPPFLAGS = -MMD -MP -I../foo
#CC      = $(CXX) # link with CXX for .cpp

# target name is basename of one of the source files
main : $(patsubst %.c,%.o,$(wildcard *.c)) # .cpp
-include *.d
clean : ; -rm -fr *.o *.d main
.PHONY : clean
$
