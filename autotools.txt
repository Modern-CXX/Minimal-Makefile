Alexandre Duret-Lutz
Autotools Tutorial, Handout version in PDF
(4 slides per pages without animations, for printing)
https://www.lrde.epita.fr/~adl/autotools.html
https://www.lrde.epita.fr/~adl/dl/autotools-handout-4.pdf

$ cd hello
$ find . | sed -e 's;[^/]*/;|____;g;s;____|; |;g'
.
|____foo
| |____foo.h
| |____Makefile.am
| |____foo.c
|____main
| |____main.c
| |____Makefile.am
|____Makefile.am
|____autogen.sh
|____configure.ac
$

$ apt install build-essential git perl flex bison gperf
$ apt install automake autoconf libtool pkg-config gettext
$
$ autoscan
$ mv configure.scan configure.ac
$ vi configure.ac

AC_PREREQ([2.71])
AC_INIT([PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDR])

AM_INIT_AUTOMAKE([foreign])
AC_CONFIG_MACRO_DIRS([m4])
AM_PROG_AR
LT_INIT

AC_PROG_CC # CXX

# put Makefile in dependency directory first
AC_CONFIG_FILES([Makefile foo/Makefile main/Makefile])

AC_OUTPUT
$
$ cat Makefile.am
ACLOCAL_AMFLAGS = -I m4
# put dependency directory first
SUBDIRS = foo main
$
$ cat foo/Makefile.am
lib_LTLIBRARIES = libfoo.la
libfoo_la_SOURCES = foo.c foo.h
#libfoo_la_CPPFLAGS = -I../bar
#libfoo_la_LIBADD = ../bar/libbar.la # -L../bar/.libs/ -lbar
CFLAGS = -std=c99 -g # CXXFLAGS
$
$ cat main/Makefile.am
bin_PROGRAMS = main
main_SOURCES = main.c
main_CPPFLAGS = -I../foo
main_LDADD = ../foo/libfoo.la # -L../foo/.libs -lfoo
CFLAGS = -std=c99 -g # CXXFLAGS
$
$ autoreconf -i && ./configure && make
$
$ cat autogen.sh
# usage
# ./autogen
# ./autogen clean

# autogen
if (( $# == 0 )); then
    [[ ! -d m4 ]] && mkdir m4
    autoreconf -i
fi

# clean
if [[ $1 == "clean" ]]; then
    # temporary files generated during autoreconf -i
    rm -fr aclocal.m4 compile config.* configure \
        configure~ depcomp install-sh m4 missing ar-lib \
        autom4te.cache ltmain.sh

    find . -name "Makefile.in" -exec rm -fr {} \;

    # temporary files generated during ./configure
    rm -fr libtool stamp-h1
    find . -name ".deps" -type d -exec rm -fr {} \;
    find . -name "Makefile" -exec rm -fr {} \;
fi
$
